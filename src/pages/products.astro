---
import Layout from '../layouts/Layout.astro';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
import Section from '../components/Section.astro';
import Button from '../components/Button.astro';
import products from '../data/products.json';

function formatPrice(price: number): string {
  return new Intl.NumberFormat('id-ID').format(price);
}

const whatsappBase = "https://wa.me/6287778131579?text=";
---

<Layout title="Produk & Harga" description="Daftar lengkap kasur Golden Comfort dengan harga. 4 seri: Essential, Comfort, Support, Support+. Ukuran custom tersedia.">
  <Header />

  <!-- Hero -->
  <section class="bg-gradient-to-b from-amber-50 to-white py-12 lg:py-16">
    <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
      <h1 class="text-3xl lg:text-4xl font-bold text-stone-900 mb-4">
        Produk & Harga Transparan
      </h1>
      <p class="text-stone-600 max-w-xl mx-auto mb-6">
        4 seri untuk setiap kebutuhan. Semua model include cover knit premium.
      </p>

      <!-- R70 Education Callout -->
      <div class="inline-flex items-center gap-3 bg-green-50 border border-green-200 rounded-xl px-4 py-3 text-sm">
        <div class="flex-shrink-0 w-8 h-8 bg-green-500 rounded-full flex items-center justify-center">
          <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
          </svg>
        </div>
        <span class="text-stone-700">
          <strong class="text-green-700">Support+</strong> pakai busa R70 (70 kg/m³) — ortopedik asli, bukan D30 abal-abal
        </span>
      </div>

      <!-- Retail Comparison -->
      <div class="mt-4 text-sm text-stone-500">
        Bandingkan: Toko retail jual ortopedik 160×200 = <span class="line-through">Rp 4-5 juta</span> →
        <span class="font-semibold text-green-600">Kami mulai Rp 2 juta (hemat 40-50%)</span>
      </div>
    </div>
  </section>

  <!-- Jump Nav -->
  <div class="sticky top-16 z-30 bg-white border-b border-stone-100 py-3">
    <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex gap-2 overflow-x-auto pb-1">
        {products.series.map((series) => (
          <a
            href={`#${series.id}`}
            class="flex-shrink-0 px-4 py-2 rounded-full text-sm font-medium bg-stone-100 hover:bg-amber-100 text-stone-700 hover:text-amber-700 transition-colors"
          >
            {series.name}
          </a>
        ))}
        <a
          href="#custom"
          class="flex-shrink-0 px-4 py-2 rounded-full text-sm font-medium bg-stone-100 hover:bg-amber-100 text-stone-700 hover:text-amber-700 transition-colors"
        >
          Custom
        </a>
      </div>
    </div>
  </div>

  <!-- Products -->
  <Section background="white" size="md">
    {products.series.map((series, index) => {
      const whatsappLink = `${whatsappBase}${encodeURIComponent(`Halo, saya tertarik dengan kasur ${series.name}. Bisa info lebih lanjut?`)}`;
      const sizes = Object.keys(series.prices);
      const thicknesses = series.thicknesses;

      return (
        <div id={series.id} class={`scroll-mt-32 ${index > 0 ? 'mt-16 pt-16 border-t border-stone-200' : ''}`}>
          <!-- Series Header -->
          <div class="flex flex-col lg:flex-row lg:items-start lg:justify-between gap-6 mb-8">
            <div class="flex-1">
              <div class="flex flex-wrap items-center gap-3 mb-3">
                <h2 class="text-2xl lg:text-3xl font-bold text-stone-900">{series.name}</h2>
                <span class="bg-amber-100 text-amber-700 text-xs font-semibold px-3 py-1 rounded-full">
                  {series.warranty}
                </span>
              </div>
              <p class="text-amber-600 font-medium mb-2">{series.feel} • {series.foam}</p>
              <p class="text-stone-600 text-sm mb-2">{series.target}</p>
              {series.construction && (
                <div class="mt-3 p-3 bg-stone-50 rounded-lg text-sm">
                  <p class="text-stone-700 font-medium mb-1">Konstruksi 2 lapis:</p>
                  <div class="text-stone-600 space-y-1">
                    {Object.entries(series.construction).map(([thickness, detail]) => (
                      <div class="flex gap-2">
                        <span class="text-stone-400">{thickness}:</span>
                        <span>{detail}</span>
                      </div>
                    ))}
                  </div>
                </div>
              )}
            </div>
            <Button variant="whatsapp" href={whatsappLink} target="_blank" size="sm">
              Tanya {series.name}
            </Button>
          </div>

          <!-- Price Table -->
          <div class="overflow-x-auto rounded-xl border border-stone-200">
            <table class="w-full">
              <thead>
                <tr class="bg-stone-50">
                  <th class="text-left py-3 px-4 text-sm font-semibold text-stone-700">Ukuran</th>
                  {thicknesses.map((t) => (
                    <th class="text-center py-3 px-4 text-sm font-semibold text-stone-700">{t}</th>
                  ))}
                </tr>
              </thead>
              <tbody class="divide-y divide-stone-100">
                {sizes.map((size) => (
                  <tr class="hover:bg-stone-50 transition-colors">
                    <td class="py-3 px-4 text-sm font-medium text-stone-900">{size}</td>
                    {thicknesses.map((t) => (
                      <td class="text-center py-3 px-4 text-sm text-stone-700">
                        Rp {formatPrice(series.prices[size][t])}
                      </td>
                    ))}
                  </tr>
                ))}
              </tbody>
            </table>
          </div>
        </div>
      );
    })}
  </Section>

  <!-- Custom Sizing -->
  <section id="custom" class="scroll-mt-32 bg-stone-50 py-16">
    <div class="max-w-3xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="text-center mb-8">
        <h2 class="text-2xl font-bold text-stone-900 mb-3">Ukuran Custom</h2>
        <p class="text-stone-600">
          Butuh ukuran khusus? Kami buat ukuran apapun. Harga = ukuran standar terdekat ke atas.
        </p>
      </div>

      <div class="bg-white rounded-2xl p-6 shadow-sm border border-stone-200">
        <h3 class="font-semibold text-stone-900 mb-4 text-sm uppercase tracking-wide">Contoh Perhitungan</h3>
        <div class="space-y-3">
          {products.customSizing.examples.map((ex) => (
            <div class="flex items-center text-sm">
              <span class="bg-stone-100 px-3 py-1.5 rounded-lg font-mono text-stone-700">{ex.custom}</span>
              <svg class="w-4 h-4 mx-3 text-stone-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3"/>
              </svg>
              <span class="text-stone-600">Harga ukuran <span class="font-semibold text-stone-900">{ex.priced_as}</span></span>
            </div>
          ))}
        </div>
        <div class="mt-6 pt-4 border-t border-stone-100 flex items-center justify-between text-sm">
          <span class="text-stone-500">Waktu produksi</span>
          <span class="font-semibold text-stone-900">{products.customSizing.timeline}</span>
        </div>
      </div>

      <div class="text-center mt-8">
        <a href="/custom-order" class="text-amber-600 hover:text-amber-700 font-medium inline-flex items-center gap-1">
          Cara order custom
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
          </svg>
        </a>
      </div>
    </div>
  </section>

  <Footer />
</Layout>
